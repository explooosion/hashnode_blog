---
title: "Egret - Bitmap ç„¡é™ã®æ»¾å‹•èƒŒæ™¯å¯¦ä½œ"
seoTitle: "Egret - Bitmap ç„¡é™ã®æ»¾å‹•èƒŒæ™¯å¯¦ä½œ"
seoDescription: "ç„¡é™æœˆæœˆæœˆæœˆæœˆæœˆæœˆæœˆÂ ğŸ‘ğŸ‘Â å ´æ™¯è£½ä½œ..."
datePublished: Tue Feb 13 2018 00:00:00 GMT+0000 (Coordinated Universal Time)
cuid: cm6jbf146000e09l19ezy71gg
slug: egret-bitmap
cover: https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/banner/0.png

---

ç„¡é™æœˆæœˆæœˆæœˆæœˆæœˆæœˆæœˆÂ ğŸ‘ğŸ‘Â å ´æ™¯è£½ä½œ...

å‰è¨€
--

ç„¡é™æœˆè®€ã®....Â 

![0](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/0)

\-

åœ¨ 2D éŠæˆ²ä¸­ï¼Œå¸¸å¸¸å¯ä»¥çœ‹åˆ°ç§»å‹•ä¸­çš„å ´æ™¯ï¼ˆèƒŒæ™¯ï¼‰ï¼Œ

é€™äº›èƒŒæ™¯åœ–ç‰‡ï¼Œä¸»è¦æ˜¯ç”±åŒä¸€å¼µåœ–ç‰‡ç¹ªè£½çµ„åˆè€Œæˆ [Bitmap](https://zh.wikipedia.org/zh-tw/BMP) çš„ã€‚

ç¤ºæ„åœ–å¦‚ä¸‹ [Flappy Bird](http://flappybird.io/)ï¼š

![09-parallax-scrolling.gif](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/09-parallax-scrolling.gif)

æœ¬ç¯„ä¾‹å¯¦ä½œçµæœæ”¾ç½®æ–¼ Github ä¸Šï¼Œå¯ç›´æ¥ clone ä¸‹ä¾†ã€‚

*   **[Egret-ScrollScene](https://github.com/explooosion/Egret-ScrollScene)**

æ¦‚å¿µè¨­è¨ˆ
----

### å¼µæ•¸è¨ˆç®—

åˆæˆèƒŒæ™¯çš„å¼µæ•¸ä¸»è¦ä¾æ“šå®¹å™¨çš„å°ºå¯¸é€²è¡Œè¨ˆç®—ï¼š

```typescript
// å¼µæ•¸ = Math.ceil( å®¹å™¨å¯¬åº¦ / åœ–ç‰‡å¯¬åº¦ ) +1
this.rowCount = Math.ceil(this.stageW / this.textureWidth) + 1;
```

*   [Math.ceil](http://www.w3school.com.cn/jsref/jsref_ceil.asp)ï¼šå–å¾—å¤§æ–¼æˆ–ç­‰æ–¼çš„æ•´æ•¸ï¼ˆè™•ç†å°æ•¸å•é¡Œï¼‰ã€‚
*   +1ï¼šè¦ç¢ºä¿æœ€å°‘å¼µæ•¸ > 2ï¼Œé¿å…åµæ¸¬çš„æ™‚å€™ï¼Œæ²’æœ‰éè£œçš„åœ–ç‰‡ã€‚

å¦‚æœæœ€å°‘å¼µæ•¸ç‚º 1 çš„æ™‚å€™ï¼Œç‚ºäº†åµæ¸¬ç•¶å‰åœ–ç‰‡ï¼ˆå¡«æ»¿ï¼‰ï¼Œæœƒä½¿å¾—å³å´ç•™ç™½ï¼Œ

å› æ­¤éœ€è¦é¡å¤–ä¸€å¼µåœ–ï¼ˆæ¡†ç·šï¼‰ï¼Œå»è£œè¶³ç©ºç™½åœ°æ–¹ã€‚

![1518522715_23657.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518522715_23657.png)

### èƒŒæ™¯åœ–æ‹¼è²¼æˆä¸€å€‹é™£åˆ—

è¨ˆç®—å‡ºæœ€å°‘å¼µæ•¸å¾Œï¼Œä½¿ç”¨è¿´åœˆå°‡æ¯å¼µåœ–çµ„åˆèµ·ä¾†ï¼š

```typescript
// çµ„åˆå¥½çš„åœ–å…¶å¯¦å°±æ˜¯åˆ©ç”¨é™£åˆ—æ‹¼è²¼èµ·ä¾†
private bmpArr: egret.Bitmap[];
```
```typescript
// åˆå§‹åŒ–æ¸…ç©ºé™£åˆ—
this.bmpArr = [];

for (var i: number = 0; i < this.rowCount; i++) {

    var bgBmp: egret.Bitmap = èƒŒæ™¯åœ–;

    // ç•¶å‰åº§æ¨™ä¾åœ–ç‰‡å¯¬åº¦å»ä¹˜ä»¥å¼µæ•¸
    bgBmp.x = this.textureWidth * i;
    ...
}
```

å‡è¨­æœ€å°‘å¼µç‚ºä¸‰å¼µåœ–ï¼Œè€Œç´ æåœ–ç‰‡å¯¬åº¦ç‚º 30ï¼Œ

xè»¸åº§æ¨™åˆ©ç”¨ iï¼Œå³ç´¢å¼•ï¼ˆindexï¼‰ï¼Œå»ä¹˜èƒŒæ™¯åœ–å¯¬åº¦ï¼š

*   ç¬¬ä¸€å¼µ xåº§æ¨™Â 0ï¼š30 \* 0
*   ç¬¬äºŒå¼µ xåº§æ¨™Â 30ï¼š 30 \* 1
*   ç¬¬ä¸‰å¼µ xåº§æ¨™Â 60ï¼š 30 \* 2

![1518524600_35941.jpg](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518524600_35941.jpg)

### é™£åˆ—å€¼æ–°å¢ç§»é™¤æ“ä½œ

è¶…å‡ºé‚Šç•Œçš„åˆ¤å®šæ–¹å¼ç‚ºåœ–ç‰‡æ•´å€‹è¶…å‡ºæ–¼ä¸»å®¹å™¨å¤–ï¼Œ

å› æ­¤å…¬å¼åˆ¤å®šç‚ºï¼š

```typescript
// ç•¶å‰é™£åˆ—å…ƒç´ .Xè»¸ <= -1 * åœ–ç‰‡å¯¬åº¦
this.bmpArr[index].x <= -1 * this.textureWidth
```

ç•«é¢ç§»å‹•çš„éç¨‹ä¸­ï¼Œç•¶Â xè»¸ è¶…å‡ºå®¹å™¨é‚Šç•Œæ™‚ï¼Œå°±å°‡è©²å…ƒç´ ç§»é™¤æ–¼é™£åˆ—å¤–ã€‚

```typescript
this.bmpArr.shift();
```

*   åˆ©ç”¨ [shift](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/shift) å¾é™£åˆ—ä¸­ç§»é™¤**ç¬¬ä¸€å€‹**å…ƒç´ ã€‚

![1518542900_88941.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518542900_88941.png)

å› ç‚ºç¸½å¼µæ•¸å°‘äº†ä¸€å¼µï¼ˆå…ƒç´ ï¼‰ï¼Œæ‰€ä»¥è¦åœ¨é™£åˆ—æœ«ç«¯æ–°å¢ä¸€å€‹åœ–ç‰‡ã€‚

ç•¶ç„¶è¦è®“åœ–ç‰‡é»åœ¨ä¸€èµ·æ¥çºŒä¸‹å»ï¼Œå› æ­¤ xè»¸ç‚ºï¼š

```typescript
// é¦–å…ˆ clone ä¸€å€‹å…ƒç´ 
var bgBmp: egret.Bitmap = this.bmpArr[index]

// æ–°å…ƒç´ xè»¸ = é™£åˆ—ä¸­æœ€å¾Œä¸€å€‹å…ƒç´ .xè»¸ + åœ–ç‰‡å¯¬åº¦ 
bgBmp.x = this.bmpArr[this.rowCount - 1].x + this.textureWidth;

// åˆ©ç”¨ push æ–¹å¼æ¨é€²é™£åˆ—ä¸­
this.bmpArr.push(bgBmp);
```

*   Â åˆ©ç”¨ [push](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/push)Â æ·»åŠ è©²å…ƒç´ è‡³é™£åˆ—çš„æœ«ç«¯ã€‚

![1518544560_38357.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518544560_38357.png)

ä»¥ä¸Šå‹•ä½œå®Œæˆå¾Œï¼Œåˆå›åˆ°æœ€åŸæœ¬çš„é™£åˆ—ï¼š

![1518545408_23555.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518545408_23555.png)

å¯¦ä½œæ»¾å‹•
----

### å»ºç«‹å°ˆæ¡ˆ

å ´æ™¯æ‰€ä½¿ç”¨åˆ°çš„ lib åªæœ‰Â egret æ ¸å¿ƒåº«ã€res è³‡æºåŠ è¼‰åº«ã€‚

[![1518547083_52315.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518547083_52315.png)](https://dotblogsfile.blob.core.windows.net/user/incredible/7aaaf1f5-032e-4c8f-b26d-e0ec2425457b/1518547083_52315.png)

åœ¨éŠæˆ²é–‹ç™¼ä¸Šï¼Œæœ¬ç¯„ä¾‹ä½¿ç”¨çš„ç³»çµ±æ¶æ§‹ï¼Œ

æœƒå¦å¤–å»ºç«‹è³‡æ–™å¤¾ mygameã€utilsÂ ä»¥åŠéŠæˆ²çš„ namespaceï¼Œæª”æ¡ˆæ¶æ§‹å¦‚ä¸‹ï¼š

![1518552347_17185.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518552347_17185.png)

*   GameContainer.tsï¼šéŠæˆ²ä¸»ç•«é¢å®¹å™¨
*   BgMap.tsï¼šå ´æ™¯
*   GameUtil.tsï¼šå¸¸ç”¨æ–¹æ³•

mygame / GameContainer.ts

```typescript
module mygame {
    export class GameContainer extends egret.DisplayObjectContainer {

    }
}
```

mygame / BgMap.ts

```typescript
module mygame {
    export class BgMap extends egret.DisplayObjectContainer {

    }
}
```

utils / GameUtil.ts

```typescript
module mygame {

    /**
     * æ ¹æ“šnameé—œéµå­—å»ºç«‹ä¸€å€‹Bitmapå°è±¡ã€‚nameå±¬æ€§è«‹åƒè€ƒresources/default.res.jsoné…ç½®æ–‡ä»¶çš„å…§å®¹ã€‚
     */
    export function createBitmapByName(name: string): egret.Bitmap {
        var result: egret.Bitmap = new egret.Bitmap();
        var texture: egret.Texture = RES.getRes(name);
        result.texture = texture;
        return result;
    }
}
```

### åœ–ç‰‡è³‡æºæ–°å¢

å°‡èƒŒæ™¯åœ–ç‰‡è³‡æºæ”¾å…¥ resourceï¼Œå¯ä»¥ä½¿ç”¨æœ¬ç¯„ä¾‹Â â†“ â†“ â†“ æˆ–æ˜¯å¦è¡Œæº–å‚™ã€‚

[![1518557915_88889.jpg](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518557915_88889.jpg)](https://dotblogsfile.blob.core.windows.net/user/incredible/7aaaf1f5-032e-4c8f-b26d-e0ec2425457b/1518557915_88889.jpg)

å¦‚æœ IDE ( Egret Wing )Â å‡ºç¾æç¤ºï¼Œè«‹é¸æ“‡ Saveã€‚

[![1518554406_68757.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518554406_68757.png)](https://dotblogsfile.blob.core.windows.net/user/incredible/7aaaf1f5-032e-4c8f-b26d-e0ec2425457b/1518554406_68757.png)

é€™æ™‚å€™æŸ¥çœ‹ resource / default.res.jsonã€‚

![1518554365_85531.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518554365_85531.png)

åˆ‡æ›è‡³ Design æª¢è¦–æ¨¡å¼ï¼Œæ‡‰è©²å¯ä»¥çœ‹åˆ°å‰›å‰›æ–°å¢çš„è³‡æºé …ç›®ï¼š

[![1518554579_64116.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518554579_64116.png)](https://dotblogsfile.blob.core.windows.net/user/incredible/7aaaf1f5-032e-4c8f-b26d-e0ec2425457b/1518554579_64116.png)

*   Nameï¼šå¦‚æœè¦èª¿ç”¨è©²åœ–ç‰‡è³‡æºï¼Œä¸å†éœ€è¦è¼¸å…¥æ•´å€‹è·¯å¾‘ urlï¼Œåƒ…éœ€è¦è¼¸å…¥è³¦äºˆçš„Â Name

å¦‚æœæ²’æœ‰ï¼Œå°±è«‹ç›´æ¥æ‹–æ›³åˆ° Drop Here å§ï½

![1518554302_90328.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518554302_90328.png)

### æ»¾å‹•èƒŒæ™¯è¨­è¨ˆ

æ¥è‘—æ–°å¢ä¸€äº›èƒŒæ™¯åœ–æœƒç”¨åˆ°çš„åŸºæœ¬å±¬æ€§ï¼š

mygame / BgMap.ts

```typescript
// å­˜æ”¾ç”±åœ–ç‰‡åˆä½µè€Œæˆçš„å¤§åœ–(åº•ç‰‡
private bmpArr: egret.Bitmap[];

// åœ–ç‰‡æ•¸é‡
private rowCount: number;

// å®¹å™¨å¯¬
private stageW: number;

// å®¹å™¨é«˜
private stageH: number;

// åœ–ç‰‡ä¾†æºå¯¬
private textureWidth: number;

// å ´æ™¯ç§»å‹•é€Ÿåº¦
private speed: number = 10;
```

æ–¼èˆå°ï¼ˆSTAGEï¼‰å»ºç«‹éšæ®µè®€å–è³‡æºï¼Œ

è¨ˆç®—æ‰€éœ€åœ–ç‰‡å¼µæ•¸ï¼Œä¸¦å„²å­˜èƒŒæ™¯åœ–é›†åˆæ–¼é™£åˆ—ä¸­ã€‚

mygame / BgMap.ts

```typescript
public constructor() {
    super();
    this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
}

private onAddToStage(event: egret.Event) {

    this.removeEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);

    this.stageW = this.stage.stageWidth;
    this.stageH = this.stage.stageHeight;
    var texture: egret.Texture = RES.getRes("bg_jpg");

    this.textureWidth = texture.textureWidth;

   ã€€// è¨ˆç®—ç•¶å‰å®¹å™¨(æˆ–è¢å¹•), éœ€è¦å¤šå°‘å¼µåœ–ç‰‡æ‰èƒ½å¡«æ»¿
    this.rowCount = Math.ceil(this.stageW / this.textureWidth) + 1;
    this.bmpArr = [];
    
    // å°‡åœ–ç‰‡ä¸¦åˆ—åœ¨ä¸€èµ·
    for (var i: number = 0; i < this.rowCount; i++) {
        var bgBmp: egret.Bitmap = mygame.createBitmapByName("bg_jpg");
        bgBmp.x = this.textureWidth * i;
        console.log(bgBmp.x);
        this.bmpArr.push(bgBmp);
        this.addChild(bgBmp);
    }
}
```

å»ºç«‹åŸºæ–¼å¹€æ•¸çš„é–‹å§‹èˆ‡åœæ­¢äº‹ä»¶ï¼Œç•¶é–‹å§‹æ™‚ï¼ŒæœƒåŸ·è¡ŒÂ enterFrameHandler ã€‚

mygame / BgMap.ts

```typescript
/**
 * é–‹å§‹æ»¾å‹•
 */
public start(): void {
    this.removeEventListener(egret.Event.ENTER_FRAME, this.enterFrameHandler, this);
    this.addEventListener(egret.Event.ENTER_FRAME, this.enterFrameHandler, this);
}

/**
 * æ»¾å‹• - ENTER_FRAME
 */
private enterFrameHandler(event: egret.Event) {

}

/**
 * æš«åœæ»¾å‹•
 */
public pause(): void {
    this.removeEventListener(egret.Event.ENTER_FRAME, this.enterFrameHandler, this);
}
```

åœ¨æ»¾å‹•çš„äº‹ä»¶ä¸­ï¼Œåˆ©ç”¨è¿´åœˆï¼Œå°‡æ‰€æœ‰åœ–ç‰‡ä¸æ–·åœ°å‘å·¦ç§»å‹•ï¼Œ

ç•¶å‰åœ–ç‰‡å¦‚æœè¶…éé‚Šç•Œï¼Œå°±å°‡è©²å…ƒç´ ç§»é™¤ï¼Œä¸¦æ¨å…¥æ–°å…ƒç´ æ–¼æœ«ç«¯ã€‚

mygame / BgMap.ts

```typescript
/**
 * æ»¾å‹• - ENTER_FRAME
 */
private enterFrameHandler(event: egret.Event) {

    for (var i: number = 0; i < this.rowCount; i++) {

        if (this.bmpArr[i].x <= -1 * this.textureWidth) {

            var bgBmp: egret.Bitmap = this.bmpArr[i];
            bgBmp.x = this.bmpArr[this.rowCount - 1].x + this.textureWidth;

            this.bmpArr.shift();
            this.bmpArr.push(bgBmp);

            // è™•ç†ä½ç½®è·³æ ¼å•é¡Œ
            this.bmpArr.forEach(bmp => {
                bmp.x += this.speed;
            });

        }
        this.bmpArr[i].x -= this.speed;
    }
}
```

### å°‡æ»¾å‹•èƒŒæ™¯åŠ å…¥æ–¼éŠæˆ²å®¹å™¨ä¸­

å®£å‘Šä¸€å€‹èƒŒæ™¯åœ–ï¼Œä¸”æ˜¯åŸºæ–¼æˆ‘å€‘å‰›å‰›å»ºç«‹å¥½çš„ BgMapã€‚

mygame / GameContainer.ts

```typescript
private bg: mygame.BgMap;
```

æ–¼éŠæˆ²å®¹å™¨çš„èˆå°ï¼ˆSTAGEï¼‰å»ºæ§‹éšæ®µï¼Œå°‡èƒŒæ™¯åŠ å…¥ï¼Œ

ä¸¦ä¸”ç«‹å³é–‹å§‹æ»¾å‹•ã€‚

mygame / GameContainer.ts

```typescript
public constructor() {
    super();
    this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
}

private onAddToStage(event: egret.Event) {
    this.removeEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
    this.createGameScene();
}

private createGameScene(): void {
    this.bg = new mygame.BgMap();
    this.addChild(this.bg);

    // èƒŒæ™¯é–‹å§‹æ»¾å‹•
    this.bg.start();
}
```

### å°‡è©²éŠæˆ²å®¹å™¨åŠ å…¥æ–¼ä¸»é«”å®¹å™¨

ç”±æ–¼æˆ‘å€‘æ˜¯å»ºç«‹ç©ºçš„å°ˆæ¡ˆï¼Œå°æ–¼è³‡æºçš„æ›è¼‰æ–¹å¼å°šæœªè¨­å®šï¼Œ

å› æ­¤æˆ‘å€‘è¦å°‡è¨­å®šæª”Â default.res.jsonÂ è¼‰å…¥ã€‚

å»ºç«‹éŠæˆ²å°ˆæ¡ˆæ™‚ï¼Œé¸æ“‡ game éŠæˆ²åº«ï¼Œå¯ä»¥çœ‹åˆ°é€™äº›æ–¹æ³•ï¼

Main.ts

```typescript
public constructor() {
    super();
    this.addEventListener(egret.Event.ADDED_TO_STAGE, this.onAddToStage, this);
}

private onAddToStage(event: egret.Event) {

    //åˆå§‹åŒ–Resourceèµ„æºåŠ è½½åº“
    //initiate Resource loading library
    RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE, this.onConfigComplete, this);
    RES.loadConfig("resource/default.res.json", "resource/");
}

/**
 * é…ç½®æ–‡ä»¶åŠ è½½å®Œæˆ,å¼€å§‹é¢„åŠ è½½preloadèµ„æºç»„ã€‚
 * configuration file loading is completed, start to pre-load the preload resource group
 */
private onConfigComplete(event: RES.ResourceEvent): void {
    RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE, this.onConfigComplete, this);
    RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onResourceLoadComplete, this);
    RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onResourceLoadError, this);
    RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR, this.onItemLoadError, this);
    RES.loadGroup("preload");
}

/**
 * preloadèµ„æºç»„åŠ è½½å®Œæˆ
 * Preload resource group is loaded
 */
private onResourceLoadComplete(event: RES.ResourceEvent) {
    if (event.groupName == "preload") {
        RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onResourceLoadComplete, this);
        RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onResourceLoadError, this);
        RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR, this.onItemLoadError, this);
    }
}

/**
 * èµ„æºç»„åŠ è½½å‡ºé”™
 *  The resource group loading failed
 */
private onItemLoadError(event: RES.ResourceEvent) {
    console.warn("Url:" + event.resItem.url + " has failed to load");
}

/**
 * èµ„æºç»„åŠ è½½å‡ºé”™
 *  The resource group loading failed
 */
private onResourceLoadError(event: RES.ResourceEvent) {
    //TODO
    console.warn("Group:" + event.groupName + " has failed to load");
    //å¿½ç•¥åŠ è½½å¤±è´¥çš„é¡¹ç›®
    //Ignore the loading failed projects
    this.onResourceLoadComplete(event);
}
```

åœ¨Â onResourceLoadComplete ä¸­ï¼Œç•¶è¼‰å…¥å®Œç•¢çš„ç¾¤çµ„ç­‰æ–¼Â preloadï¼Œ

æˆ‘å€‘å°±å¯ä»¥å»ºæ§‹éŠæˆ²å®¹å™¨äº†ï¼

Main.ts

```typescript
if (event.groupName == "preload") {
    RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE, this.onResourceLoadComplete, this);
    RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR, this.onResourceLoadError, this);
    RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR, this.onItemLoadError, this);

    //æ¸¸æˆçš„ä¸»ç±»å¼€å§‹å®ä¾‹åŒ–
    var gameContainer: mygame.GameContainer = new mygame.GameContainer();
    this.addChild(gameContainer);
}
```

ç‚ºä»€éº¼æ˜¯Â preloadï¼Ÿ

åœ¨ resource / default.res.json ä¸­ï¼Œåˆ‡æ›è‡³ Source æª¢è¦–æ¨¡å¼ï¼Œ

å¯ä»¥çœ‹åˆ°ç³»çµ±é è¨­å»ºç«‹åç‚ºÂ preload çš„ç¾¤çµ„ï¼ˆgroupsï¼‰ï¼š

```json
{
 "groups": [
  {
   "name": "preload",
   "keys": "bg_jpg"
  }
 ],
 "resources": [
  {
   "name": "bg_jpg",
   "type": "image",
   "url": "bg.jpg"
  }
 ]
}
```

### ç·¨è­¯åŸ·è¡Œçµæœ

Shift \+ Ctrl \+ Bå¿«æ·éµç·¨è­¯å§ï¼

å¦‚æœå‡ºç¾ä¸€äº› template æ‰¾ä¸åˆ° debugÂ éŒ¯èª¤ï¼Œ

è«‹åœ¨è©²åº•ä¸‹è‡ªè¡Œæ‰‹å‹•å»ºç«‹è³‡æ–™å¤¾ï¼Œ

ç„¶å¾Œå°‡ template / web / index.html è¤‡è£½æ–¼æ­¤åº•ä¸‹ï¼Œå¦‚ä¸‹åœ–çµæœï¼š

![1518558120_74798.png](https://raw.githubusercontent.com/explooosion/blogs/refs/heads/main/docs/images/2018-02-13_Egret%20-%20Bitmap%20%E7%84%A1%E9%99%90%E3%81%AE%E6%BB%BE%E5%8B%95%E8%83%8C%E6%99%AF%E5%AF%A6%E4%BD%9C/1518558120_74798.png)

åƒè€ƒè³‡æ–™
----

*   [Egret å®æˆ˜ - é£è¡Œå°„å‡»ç±»æ¸¸æˆ - ä½¿ç”¨Egretåˆ›å»ºä¸€ä¸ªæ‰“é£æœºçš„æ¸¸æˆ](http://edn.egret.com/cn/index.php/portal/article/index/id/712)
*   [NeoGuo](https://github.com/NeoGuo)[/](https://github.com/NeoGuo/html5-documents/blob/master/egret/sample-1.md)[html5-documents](https://github.com/NeoGuo/html5-documents/blob/master/egret/sample-1.md)
    
*   [Array.prototype.pop() - JavaScript - MDN - Mozilla](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/pop)
    
*   [Array.prototype.push() - JavaScript - MDN - Mozilla](https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/push)
    

æœ‰å‹˜èª¤ä¹‹è™•ï¼Œä¸åæŒ‡æ•™ã€‚ob'\_'ov